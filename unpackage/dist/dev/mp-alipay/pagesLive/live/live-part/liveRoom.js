;my.defineComponent || (my.defineComponent = Component);(my["webpackJsonp"] = my["webpackJsonp"] || []).push([["pagesLive/live/live-part/liveRoom"],{

/***/ 1550:
/*!*******************************************************************************************************************!*\
  !*** D:/work3/shumazulin_client/haoshiji_project/haoshiji_uniapp/haoshiji/pagesLive/live/live-part/liveRoom.nvue ***!
  \*******************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./liveRoom.nvue?vue&type=template&id=692a8b96&scoped=true& */ 1551);
/* harmony import */ var _liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./liveRoom.nvue?vue&type=script&lang=js& */ 1553);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony import */ var _software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */ 40);

var renderjs




/* normalize component */

var component = Object(_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__["default"])(
  _liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["render"],
  _liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  "692a8b96",
  null,
  false,
  _liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["components"],
  renderjs
)

component.options.__file = "pagesLive/live/live-part/liveRoom.nvue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ 1551:
/*!**************************************************************************************************************************************************************!*\
  !*** D:/work3/shumazulin_client/haoshiji_project/haoshiji_uniapp/haoshiji/pagesLive/live/live-part/liveRoom.nvue?vue&type=template&id=692a8b96&scoped=true& ***!
  \**************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./liveRoom.nvue?vue&type=template&id=692a8b96&scoped=true& */ 1552);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return _software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["recyclableRender"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "components", function() { return _software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_template_id_692a8b96_scoped_true___WEBPACK_IMPORTED_MODULE_0__["components"]; });



/***/ }),

/***/ 1552:
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/work3/shumazulin_client/haoshiji_project/haoshiji_uniapp/haoshiji/pagesLive/live/live-part/liveRoom.nvue?vue&type=template&id=692a8b96&scoped=true& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return recyclableRender; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "components", function() { return components; });
var components
var render = function () {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
}
var recyclableRender = false
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ 1553:
/*!********************************************************************************************************************************************!*\
  !*** D:/work3/shumazulin_client/haoshiji_project/haoshiji_uniapp/haoshiji/pagesLive/live/live-part/liveRoom.nvue?vue&type=script&lang=js& ***!
  \********************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _software_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../../software/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./liveRoom.nvue?vue&type=script&lang=js& */ 1554);
/* harmony import */ var _software_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_software_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _software_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _software_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_software_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_software_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_liveRoom_nvue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 1554:
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/work3/shumazulin_client/haoshiji_project/haoshiji_uniapp/haoshiji/pagesLive/live/live-part/liveRoom.nvue?vue&type=script&lang=js& ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(uni) {

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

var AgoraMiniappSDK = __webpack_require__(/*! ../../lib/mini-app-sdk-production.js */ 1555);
var RTMClient = __webpack_require__(/*! ../../lib/agora-rtm.js */ 1557);
var _default = {
  data: function data() {
    return {
      /*加载中*/
      loading_login: false,
      /*推流对象*/
      pusherContext: null,
      /*拉流对象*/
      playerContext: null,
      player_url: '',
      mainPusherInfo_url: '',
      room_id: '',
      /*发送消息*/
      TextMsg: '',
      /*是否打开礼物*/
      open_gift: false,
      /*评论*/
      commentsList: [],
      /*礼物*/
      giftList: [],
      /*是否打开商品列表*/
      open_products: false,
      /*当前讲解商品ID*/
      explain_product_id: '',
      /*当前讲解商品*/
      explain_product: null,
      /*是否显示更多功能*/
      open_more: false,
      /*是否美颜*/
      beauty: 5,
      /*美白*/
      whiteness: 5,
      /*前置后置*/
      device_position: 'front',
      /*打开分享*/
      open_share: false,
      /*分享参数*/
      param_share: {},
      /*分享图片*/
      qrcode: null,
      /*获取观看人数*/
      showNumTimer: null,
      /*是否点赞*/
      is_click_digg: false,
      // 房间详情
      roomDetail: {},
      // 用户信息
      userInfo: {},
      // RTC房间频道
      channel: '',
      // 应用appid
      appId: '',
      // rtm客户端
      rtm_client: null,
      reconnectTimer: null,
      // 0 - loading, 1 - ok, 2 - error
      push_status: 'loading',
      picture_mode: ["push", "pop"],
      isCaster: false
    };
  },
  props: ['winHeight', 'winWidth', 'role', 'is_replay', 'replay_url'],
  methods: {
    show: function show() {
      if (this.playerContext != null) {
        this.playerContext.play();
      }
      if (this.pusherContext) {
        this.reconnect();
      }
    },
    /*请求对象*/getRequest: function getRequest() {
      var self = this;
      return self;
    },
    start: function start(roomDetail, userInfo) {
      var self = this;
      self.roomDetail = roomDetail;
      self.userInfo = userInfo;
      self.channel = 'channel_' + roomDetail.shop_supplier_id;
      self.isCaster = self.role == 'broadcaster';
      if (self.isCaster) {
        var whiteness = uni.getStorageSync('whiteness');
        if (whiteness) {
          self.whiteness = whiteness;
        }
        var beauty = uni.getStorageSync('beauty');
        if (beauty) {
          self.beauty = beauty;
        }
      } else {
        //观众
        console.log('观众进入');
      }
      self.loginRoom();
    },
    /*直播间登录*/loginRoom: function loginRoom() {
      var self = this;
      uni.showLoading({
        title: '正在进入'
      });
      self.getRequest()._get('plus.live.agora.api/login', {
        room_id: self.roomDetail.room_id,
        channel: self.channel,
        isCaster: self.isCaster
      }, function (res) {
        self.appId = res.data.appId;
        self.initAgoraChannel(res.data.userSign).then(function (url) {
          console.log("pushing ".concat(url));
          var ts = new Date().getTime();
          self.mainPusherInfo_url = url;
          if (self.isCaster) {
            self.pusherContext = uni.createLivePusherContext('livePusher1', self);
            setTimeout(function () {
              console.log('创建 pusherContext app：', self.pusherContext);
              self.pusherContext.start();
              self.loginIM();
            }, 500);
            // 同步数据
            self.showNumTimer = setInterval(function () {
              self.synRoomInfo();
            }, 15000);
          }
        }).catch(function (e) {
          console.log("init agora client failed: ".concat(e));
          console.log(JSON.stringify(e));
          uni.showToast({
            title: "\u5BA2\u6237\u7AEF\u521D\u59CB\u5316\u5931\u8D25",
            icon: 'none',
            duration: 5000
          });
        });
      });
    },
    /**
     * 初始化sdk推流
     */
    initAgoraChannel: function initAgoraChannel(token) {
      var self = this;
      return new Promise(function (resolve, reject) {
        var client = new AgoraMiniappSDK.Client();
        //subscribe stream events
        self.subscribeEvents(client);
        AgoraMiniappSDK.LOG.onLog = function (text) {
          // callback to expose sdk logs
          console.log(text);
        };
        // info:1 WARNING:2 ERROR:3 DEBUG:0
        AgoraMiniappSDK.LOG.setLogLevel(1);
        self.client = client;
        client.setRole(self.role);
        client.init(self.appId, function () {
          console.log("client init success");
          // pass key instead of undefined if certificate is enabled
          client.join(token, self.channel, self.getRequest().getUserId(), function () {
            console.log("client join channel success");
            //and get my stream publish url
            if (self.isCaster) {
              client.publish(function (url) {
                console.log("client publish success");
                console.log('url=' + url);
                resolve(url);
              }, function (e) {
                console.log("client publish failed: ".concat(e.code, " ").concat(e.reason));
                reject(e);
              });
            } else {
              resolve();
            }
          }, function (e) {
            console.log(": ".concat(e.code, " ").concat(e.reason));
            reject(e);
          });
        }, function (e) {
          console.log("client init failed: ".concat(e, " ").concat(e.code, " ").concat(e.reason));
          reject(e);
        });
      });
    },
    loginIM: function loginIM() {
      var self = this;
      self.getRequest()._get('plus.live.agora.api/rtmToken', {
        channel: self.channel
      }, function (res) {
        self.rtm_client = new RTMClient(self.appId);
        self.onChannelEvent();
        // sdk连接状态
        self.rtm_client.on('ConnectionStateChanged', function (newState, reason) {
          console.log('The connection status', newState);
          console.log('The reason for the state change', reason);
        });
        // 登录 RTM 系统
        self.rtm_client.login(res.data.userSign, '' + self.getRequest().getUserId()).then(function () {
          console.log('AgoraRTM client login success');
          self.rtm_client.joinChannel(self.channel).then(function () {
            console.log('join channel success');
            // 发送通知
            var msg = {
              type: 'enter',
              nickName: self.userInfo.nickName
            };
            self.sendMsg(JSON.stringify(msg));
            if (self.isCaster) {
              // 直播开始
              self.getRequest()._post('plus.live.room/set_status', {
                room_id: self.roomDetail.room_id,
                status: 101
              }, function (res) {
                // 开始录制
                self.startRecord();
              });
            }
          }).catch(function (err) {
            console.log('join channel failed', err);
          });
        }).catch(function (err) {
          console.log('AgoraRTM client login failure', err);
        });
      });
    },
    /*获取直播间信息*/synRoomInfo: function synRoomInfo(e) {
      var self = this;
      self.getRequest()._post('plus.live.room/syn_room', {
        room_id: self.roomDetail.room_id
      }, function (res) {
        // 发送通知
        var msg = {
          type: 'views',
          views: res.data.model.views,
          digg_num: res.data.model.digg_num
        };
        self.sendMsg(JSON.stringify(msg));
      });
    },
    /**
     * 注册stream事件
     */
    subscribeEvents: function subscribeEvents(client) {
      var self = this;
      /**
       * sometimes the video could be rotated
       * this event will be fired with ratotion
       * angle so that we can rotate the video
       * NOTE video only supportes vertical or horizontal
       * in case of 270 degrees, the video could be
       * up side down
       */
      client.on("video-rotation", function (e) {
        console.log("video rotated: ".concat(e.rotation, " ").concat(e.uid));
      });
      /**
       * fired when new stream join the channel
       */
      client.on("stream-added", function (e) {
        var uid = e.uid;
        console.log("stream ".concat(uid, " added"));
        /**
         * subscribe to get corresponding url
         */
        client.subscribe(uid, function (url, rotation) {
          console.log("stream ".concat(uid, " subscribed successful"));
          console.log(url);
          self.player_url = url;
          self.loginIM();
        }, function (e) {
          console.log("stream subscribed failed ".concat(e, " ").concat(e.code, " ").concat(e.reason));
        });
      });

      /**
       * remove stream when it leaves the channel
       */
      client.on("stream-removed", function (e) {
        var uid = e.uid;
        console.log("stream ".concat(uid, " removed"));
      });

      /**
       * when bad thing happens - we recommend you to do a 
       * full reconnect when meeting such error
       * it's also recommended to wait for few seconds before
       * reconnect attempt
       */
      client.on("error", function (err) {
        var errObj = err || {};
        var code = errObj.code || 0;
        var reason = errObj.reason || "";
        console.log("error: ".concat(code, ", reason: ").concat(reason));
        if (code === 501 || code === 904) {
          self.reconnect();
        }
      });

      /**
       * there are cases when server require you to update
       * player url, when receiving such event, update url into
       * corresponding live-player, REMEMBER to update key property
       * so that live-player is properly refreshed
       * NOTE you can ignore such event if it's for pusher or happens before
       * stream-added
       */
      client.on('update-url', function (e) {
        console.log("update-url: ".concat(JSON.stringify(e)));
      });
    },
    onChannelEvent: function onChannelEvent() {
      var self = this;
      // 频道消息
      self.rtm_client.on('ChannelMessage', function (message, memberId) {
        var object = {
          uid: memberId,
          message: message.text
        };
        console.log('message -----');
        console.log(message);
        if (memberId != self.getRequest().getUserId()) {
          self.$emit('showMsg', message.text);
        }
      });
      //频道成员进出通知
      self.rtm_client.on('MemberJoined', function (memberId) {
        console.log('memberId: ', memberId);
      });
      self.rtm_client.on('MemberLeft', function (memberId) {
        console.log('memberId: ', memberId);
      });
    },
    /** type消息类型 文本：text,礼物：gift,进入房间：enter 观看人数：views 点赞: digg 
    	结束：over 讲解: explain
    */
    sendMsg: function sendMsg(msg) {
      var self = this;
      self.rtm_client.sendChannel(msg).then(function () {
        self.$emit('showMsg', msg);
      }).catch(function (error) {
        // 频道消息发送失败的处理逻辑
        console.log('频道消息发送失败的处理逻辑');
        console.log(error);
      });
    },
    /*直播设置*/liveSet: function liveSet(e) {
      switch (e.type) {
        case 'beauty':
          this.beauty = e.value;
          break;
        case 'whiteness':
          this.whiteness = e.value;
          break;
        case 'device_position':
          this.device_position = e.value;
          if (this.pusherContext != null) {
            this.pusherContext.switchCamera({
              type: e.value,
              success: function success(res) {
                console.log('切换成功');
              },
              fail: function fail(err) {
                console.log(err);
              }
            });
          }
          break;
      }
    },
    /**
     * reconnect when bad things happens...
     */
    reconnect: function reconnect() {
      var self = this;
      uni.showToast({
        title: '尝试恢复链接...',
        icon: 'none',
        duration: 5000
      });
      // always destroy client first
      // *important* miniapp supports 2 websockets maximum at same time
      // do remember to destroy old client first before creating new ones
      self.client && self.client.destroy();
      self.reconnectTimer = setTimeout(function () {
        self.loginRoom();
      }, 1 * 1000);
    },
    /**
     * 推流状态更新回调
     */
    recorderStateChange: function recorderStateChange(e) {
      console.log('live-pusher code: ', e);
      if (e.detail.code === -1307) {
        //re-push
        console.log('live-pusher stopped ---- error');
        this.push_status = 'error';
      }
      if (e.detail.code === 1008) {
        //started
        console.log('live-pusher started');
        if (this.push_status === "loading") {
          this.push_status = 'ok';
        }
      }
    },
    recorderNetChange: function recorderNetChange(e) {
      //console.log('netstatus:' + JSON.stringify(e));
    },
    onMainError: function onMainError(e) {
      var self = this;
      console.log('onMainError called: ', e);
    },
    /*退出 type:  auto:主动  over：结束*/
    exit: function exit(type) {
      var self = this;
      var url = '/pagesLive/live/index';
      if (self.role == 'broadcaster') {
        type = 'over';
        // 通知其他人
        var msg = {
          type: 'over'
        };
        self.sendMsg(JSON.stringify(msg));
      }
      if (type == 'over') {
        //直播结束页
        url = '/pagesLive/live/live-over?room_id=' + self.roomDetail.room_id;
      }
      self.clear();
      uni.redirectTo({
        url: url
      });
    },
    startRecord: function startRecord() {
      var self = this;
      // 请求开始录制
      if (self.isCaster) {
        self.getRequest()._post('plus.live.agora.api/record_acquire', {
          room_id: self.roomDetail.room_id
        }, function (res) {
          self.getRequest()._post('plus.live.agora.api/record_start', {
            room_id: self.roomDetail.room_id
          }, function (res) {
            self.getRequest()._post('plus.live.agora.api/record_query', {
              room_id: self.roomDetail.room_id
            }, function (res) {});
          });
        });
      }
    },
    /*销毁*/
    clear: function clear() {
      var self = this;
      try {
        if (self.showNumTimer) {
          clearInterval(self.showNumTimer);
          self.showNumTimer = null;
        }
        if (self.playerContext) {
          self.playerContext.stop();
          self.playerContext = null;
        }
        if (self.pusherContext) {
          self.pusherContext.stop();
          self.pusherContext = null;
        }
        clearTimeout(this.reconnectTimer);
        self.reconnectTimer = null;
        if (self.isCaster) {
          try {
            self.client && self.client.unpublish();
          } catch (e) {
            console.log("unpublish failed");
            console.log(e);
          }
        }
        // rtm退出
        self.client && self.client.leave();
        // rtm退出
        self.rtm_client && self.rtm_client.logout();
      } catch (e) {
        console.log(e);
      }
    }
  }
};
exports.default = _default;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-alipay/dist/index.js */ 1)["default"]))

/***/ })

}]);
;(my["webpackJsonp"] = my["webpackJsonp"] || []).push([
    'pagesLive/live/live-part/liveRoom-create-component',
    {
        'pagesLive/live/live-part/liveRoom-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('1')['createComponent'](__webpack_require__(1550))
        })
    },
    [['pagesLive/live/live-part/liveRoom-create-component']]
]);
