(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pagesLive/live/live"],{"0931":function(e,t,i){"use strict";i.r(t);var o=i("1ef1"),n=i.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(r);t["default"]=n.a},"19be":function(e,t,i){},"1ef1":function(e,t,i){"use strict";(function(e){var o=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(i("7610")),r=o(i("7be2")),s={components:{liveCart:function(){i.e("pagesLive/live/live-part/liveCart").then(function(){return resolve(i("7817"))}.bind(null,i)).catch(i.oe)},liveGift:function(){i.e("pagesLive/live/live-part/liveGift").then(function(){return resolve(i("f663"))}.bind(null,i)).catch(i.oe)},liveRoom:function(){Promise.all([i.e("common/vendor"),i.e("pagesLive/live/live-part/liveRoom")]).then(function(){return resolve(i("6142"))}.bind(null,i)).catch(i.oe)},liveMsg:function(){i.e("pagesLive/live/live-part/liveMsg").then(function(){return resolve(i("78cd"))}.bind(null,i)).catch(i.oe)},livePlan:function(){Promise.all([i.e("common/vendor"),i.e("pagesLive/live/live-part/livePlan")]).then(function(){return resolve(i("f062"))}.bind(null,i)).catch(i.oe)},liveOrder:function(){i.e("pagesLive/live/live-part/liveOrder").then(function(){return resolve(i("9760"))}.bind(null,i)).catch(i.oe)},liveAnchor:function(){i.e("pagesLive/live/live-part/liveAnchor").then(function(){return resolve(i("46ea"))}.bind(null,i)).catch(i.oe)},liveMore:function(){i.e("pagesLive/live/live-part/liveMore").then(function(){return resolve(i("3101"))}.bind(null,i)).catch(i.oe)},liveShare:function(){i.e("pagesLive/live/live-part/liveShare").then(function(){return resolve(i("c8a7"))}.bind(null,i)).catch(i.oe)},liveRank:function(){i.e("pagesLive/live/live-part/liveRank").then(function(){return resolve(i("1cf9"))}.bind(null,i)).catch(i.oe)},Likes:function(){i.e("pagesLive/live/live-part/likes/index").then(function(){return resolve(i("5194"))}.bind(null,i)).catch(i.oe)},share:function(){i.e("pagesLive/live/live-part/dialog/share").then(function(){return resolve(i("6da5"))}.bind(null,i)).catch(i.oe)},Countdown:function(){i.e("pagesLive/live/live-part/countdown_nvue").then(function(){return resolve(i("777f"))}.bind(null,i)).catch(i.oe)},AppShare:function(){Promise.all([i.e("common/vendor"),i.e("pagesLive/live/live-part/app-nvue-share")]).then(function(){return resolve(i("46f9"))}.bind(null,i)).catch(i.oe)}},data:function(){return{statusBarH:"",headerBarH:"",winHeight:"",winWidth:"",videoIndex:0,clickNum:0,giftipShowist:[],sence:"",room_id:0,shop_supplier_id:0,role:"",loading:!0,commentsList:[],maxCommentSize:100,roomDetail:{},gift_name:"",gift_num:0,hasFollow:!1,giftList:[],isCaster:!1,user:{},giftInfo:{nickName:"",avatarUrl:"",giftName:"",giftImage:""},explain_product_id:"",explain_product:null,num:0,digg_num:0,digg_times:5,digg_timer:null,is_replay:!1,replay_url:"",is_start:!1,qrcode:null,toMsg:"",emojiData:[],countdownConfig:{startstamp:0,endstamp:0,title:""},isAppShare:!1,appParams:{title:"",summary:"",path:""}}},beforeCreate:function(){},created:function(){var t=e.getSystemInfoSync().statusBarHeight,i=t+50,o=e.getSystemInfoSync().windowHeight,n=e.getSystemInfoSync().windowWidth;this.statusBarH="".concat(t,"px"),this.headerBarH="".concat(i,"px"),this.winHeight="".concat(o,"px"),this.winWidth="".concat(n,"px")},onLoad:function(t){var i=n.default.getSceneData(t);this.room_id=t.room_id?t.room_id:i.rid,this.role="create"==t.sence?"broadcaster":"audience","broadcaster"==this.role&&(this.isCaster=!0),e.setKeepScreenOn({keepScreenOn:!0})},onReady:function(){this.getRoomInfo()},onUnload:function(){this.is_start&&this.$refs.liveRoom.clear()},onShow:function(){this.$refs.liveRoom&&this.$refs.liveRoom.show()},methods:{getRequest:function(){return this},getRoomInfo:function(){var t=this;e.showLoading({title:"正在进入"}),t.getRequest()._post("plus.live.room/detail",{room_id:t.room_id},(function(i){if(e.hideLoading(),t.loading=!1,t.roomDetail=i.data.model,t.gift_name=i.data.gift_name,t.hasFollow=i.data.hasFollow,t.digg_num=i.data.model.digg_num,t.countdownConfig.endstamp=t.roomDetail.start_time,t.user=i.data.user,103==t.roomDetail.live_status){if(t.is_replay=!0,""==t.roomDetail.record_url)return void e.showModal({title:"提示",content:"暂无回放地址",success:function(t){e.navigateBack()}});t.replay_url=t.roomDetail.record_url}if(101!=t.roomDetail.live_status&&103!=t.roomDetail.live_status||(t.is_start=!0),!t.is_replay){var o=!1;!t.isCaster||101!=t.roomDetail.live_status&&102!=t.roomDetail.live_status||(o=!0),t.isCaster||101!=t.roomDetail.live_status||(o=!0),o&&(t.is_start=!0,t.initRoom(),setTimeout((function(){t.$refs.liveRoom.start(t.roomDetail,t.user),t.initProduct()}),2e3))}}))},initRoom:function(){this.getGift(),this.initemoji()},showProduct:function(e){var t=this;t.explain_product_id=e,t.getRequest()._get("plus.live.room/product_detail",{product_id:t.explain_product_id},(function(e){t.explain_product=e.data.model}))},initProduct:function(){this.roomDetail.currentProduct&&(this.explain_product={product_image:this.roomDetail.currentProduct.image[0].file_path,product_price:this.roomDetail.currentProduct.product_price,product_id:this.roomDetail.currentProduct.product_id})},gotoProduct:function(t){var i="/#/pages/product/detail/detail?product_id="+this.explain_product.product_id+"&room_id="+this.room_id;e.navigateTo({url:i})},handleSlider:function(e){var t=e.detail.current;this.videoIndex>=0&&(this.videoContextList[this.videoIndex].pause(),this.videoContextList[this.videoIndex].seek(0)),t===this.videoIndex+1?this.videoContextList[this.videoIndex+1].play():t===this.videoIndex-1&&this.videoContextList[this.videoIndex-1].play(),this.videoIndex=t},play:function(e){this.videoContextList[e].play()},pause:function(e){this.videoContextList[e].pause()},handleAttention:function(e){var t=this.vlist;t[e].attention=!t[e].attention,this.vlist=t},handleLiveCart:function(){this.$refs.liveCart.show()},handleLiveGift:function(){this.$refs.liveGift.show()},closeLive:function(){var t=this;t.is_replay?e.redirectTo({url:"/pagesLive/live/index"}):"broadcaster"==t.role?e.showModal({title:"提示",content:"确定要结束当前直播吗?",success:function(e){e.confirm&&(t.getRequest()._post("plus.live.agora.api/record_stop",{room_id:t.room_id},(function(e){})),console.log("record_stop"),t.getRequest()._post("plus.live.room/set_status",{room_id:t.room_id,status:103},(function(e){console.log("set_status"),t.$refs.liveRoom.exit("over")})))}}):t.$refs.liveRoom.exit("auto")},handleRollMsg:function(){this.$refs.liveMsg.show()},closeMsg:function(e){var t={type:"text",msg:e,nickName:this.user.nickName};this.$refs.liveRoom.sendMsg(JSON.stringify(t))},showMsg:function(e){var t=this,i=JSON.parse(e);"text"==i.type?(t.commentsList.push(i),t.removeComment()):"enter"==i.type?(t.commentsList.push(i),t.removeComment(),t.roomDetail.view_num++):"gift"==i.type?(t.giftInfo={nickName:i.nickName,avatarUrl:i.avatarUrl,giftName:t.getGiftName(i.msg),giftImage:t.getGiftImage(i.msg)},setTimeout((function(){t.giftInfo={nickName:""}}),5e3)):"views"==i.type?(t.roomDetail.view_num=i.views,t.roomDetail.digg_num=i.digg_num):"digg"==i.type?t.digg_num=i.digg_num:"over"==i.type?t.$refs.liveRoom.exit("over"):"explain"==i.type?t.showProduct(i.msg):"gift_num"==i.type&&(t.roomDetail.gift_num=i.msg)},removeComment:function(){var e=this.commentsList.length-this.maxCommentSize;if(e>0)for(var t=0;t<e;t++)this.commentsList.shift();this.toMsg="comment"+(this.commentsList.length-1)},getGift:function(){var e=this;e.getRequest()._get("plus.live.room/gift",{},(function(t){for(var i=[],o=[],n=0,r=0;r<t.data.list.length;r++)n++,o.push(t.data.list[r]),n>=8&&(i.push(o),o=[],n=0);o.length>0&&i.push(o),e.giftList=i}))},openPlan:function(){this.$refs.livePlan.show()},closePlan:function(){this.$refs.liveGift.show()},openOrder:function(){this.$refs.liveOrder.show()},closeOrder:function(){this.$refs.liveCart.show()},setProduct:function(e){var t={type:"explain",msg:e};this.$refs.liveRoom.sendMsg(JSON.stringify(t))},followFunc:function(){var e=this;e.getRequest()._post("user.Favorite/add",{shop_supplier_id:e.shop_supplier_id,pid:e.shop_supplier_id,type:10},(function(t){e.hasFollow=!e.hasFollow}))},openAnchor:function(){this.$refs.liveAnchor.show()},changeFollow:function(e){this.hasFollow=e},openMore:function(){this.$refs.liveMore.show()},openShare:function(e){this.$refs.liveShare.show()},liveSet:function(e){this.$refs.liveRoom.liveSet(e)},openRank:function(){this.$refs.liveRank.show()},sendGift:function(e){var t=e.split(","),i={type:"gift",msg:t[0],nickName:this.user.nickName,avatarUrl:this.user.avatarUrl};this.$refs.liveRoom.sendMsg(JSON.stringify(i));var o={type:"gift_num",msg:t[1]};this.$refs.liveRoom.sendMsg(JSON.stringify(o))},getGiftName:function(e){var t="";for(var i in this.giftList)for(var o=0;o<this.giftList[i].length;o++){var n=this.giftList[i][o];if(parseInt(e)===n.gift_id){t=n.gift_name;break}}return t},getGiftImage:function(e){var t="";for(var i in this.giftList)for(var o=0;o<this.giftList[i].length;o++){var n=this.giftList[i][o];if(parseInt(e)===n.gift_id){t=n.file_path;break}}return t},digg:function(){var e=this;e.$refs.likes.handleClick(),e.digg_num++,e.getRequest()._get("plus.live.room/digg",{room_id:e.room_id,num:1},(function(t){var i={type:"digg",digg_num:t.data.digg_num};e.$refs.liveRoom.sendMsg(JSON.stringify(i))}))},livePoster:function(){var t=this;e.showLoading({title:"加载中"});t.getRequest()._get("plus.live.Room/poster",{room_id:t.room_id,source:"wx"},(function(e){t.qrcode=e.data.qrcode,console.log(t.qrcode)}),null,(function(){e.hideLoading()}))},closeShare:function(){this.qrcode=null},onShareAppMessage:function(){var e=this.getRequest().getShareUrlParams({room_id:this.room_id,sence:"audience"});return{title:this.roomDetail.name,path:"/pagesLive/live/live?"+e,imageUrl:this.roomDetail.share.file_path}},initemoji:function(){for(var e=Math.ceil(r.default.length/21),t=0;t<e;t++){this.emojiData[t]=[];for(var i=0;i<21;i++)r.default[21*t+i]&&this.emojiData[t].push(r.default[21*t+i])}},goBack:function(){e.redirectTo({url:"/pagesLive/live/index"})}}};t.default=s}).call(this,i("c11b")["default"])},"2d6c":function(e,t,i){"use strict";i.r(t);var o=i("cf51"),n=i("0931");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r);i("a968"),i("ab8b");var s=i("f0c5"),a=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,"c8156166",null,!1,o["a"],void 0);t["default"]=a.exports},a968:function(e,t,i){"use strict";var o=i("19be"),n=i.n(o);n.a},ab8b:function(e,t,i){"use strict";var o=i("adde"),n=i.n(o);n.a},adde:function(e,t,i){},cf51:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){}));var o=function(){var e=this.$createElement;this._self._c},n=[]},d78f:function(e,t,i){"use strict";(function(e){var t=i("4ea4");i("a8db"),i("33db"),i("5c17");t(i("66fd"));var o=t(i("2d6c"));my.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i("c11b")["createPage"])}},[["d78f","common/runtime","common/vendor"]]]);