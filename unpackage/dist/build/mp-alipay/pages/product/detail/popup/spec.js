;my.defineComponent || (my.defineComponent = Component);(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/product/detail/popup/spec"],{1020:function(t,o,s){"use strict";var i=s("fa03"),e=s.n(i);e.a},1806:function(t,o,s){"use strict";s.r(o);var i=s("9590"),e=s.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(o,t,(function(){return i[t]}))}(r);o["default"]=e.a},9590:function(t,o,s){"use strict";(function(t){var i=s("4ea4");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=i(s("2eee")),r=i(s("7037")),n=i(s("c973")),u={data:function(){return{ContinueClicking:!1,tokendata:"",Visible:!1,is:!1,form:{detail:{},show_sku:{sku_image:""}},buy_out_price:0,stock:0,selectSpec:"",isOpenSpec:!1,type:"",show1:!1,show2:!1,show3:!1,maiduan:"",panduan:"",produnt_period:0,zuwanjisong:2}},props:["isPopup","productModel","ddshow","product_name","zmshow"],onLoad:function(){},mounted:function(){this.maiduan=this.form.show_sku.buy_out_price,this.tokendata=t.getStorageSync("token")},computed:{isadd:function(){return this.form.show_sku.sum>=this.stock||this.form.show_sku.sum>=this.form.detail.limit_num},issub:function(){return this.form.show_sku.sum<=1}},watch:{isPopup:function(t,o){t!=o&&(this.Visible=t,this.isOpenSpec||(this.form=this.productModel,this.isOpenSpec=!0,this.initShowSku()),this.form.type=this.productModel.type)},"form.specData":{handler:function(t,o){var s=this,i="",e="";if(this.isAll=!0,t){for(var r=function(o){t.spec_attr[o];null==s.form.productSpecArr[o]?(s.isAll=!1,i+=t.spec_attr[o].group_name+" "):t.spec_attr[o].spec_items.forEach((function(t){s.form.productSpecArr[o]==t.item_id&&(e+='"'+t.spec_value+'" ')}))},n=0;n<t.spec_attr.length;n++)r(n);this.isAll?e="已选: "+e:i="请选择: "+i}this.selectSpec=this.isAll?e:i},deep:!0,immediate:!0}},methods:{onGetAuthorize1:function(){var o=this;return(0,n.default)(e.default.mark((function s(){return e.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:my.getAuthCode({scopes:["auth_base"],success:function(s){my.getPhoneNumber({success:function(i){var e=i.response;e=JSON.parse(e);var r=e.response;o._post("user.usermp/mnpAlipayAuthLogin",{code:s.authCode,content:r},(function(s){t.setStorageSync("token",s.data.data.token),t.setStorageSync("user_id",s.data.data.user_id),t.showToast({title:"登录成功"}),o.tokendata=1}))},fail:function(t){reject(t)}})}});case 1:case"end":return s.stop()}}),s)})))()},getAlipayUserInfo:function(){return new Promise((function(t,o){my.getOpenUserInfo({success:function(o){var s=JSON.parse(o.response);t(s)},fail:function(t){o(t)}})}))},onAuthError:function(){t.showModal({title:"提示",content:"取消授权，可能导致服务无法使用，或者页面显示不完整",success:function(t){t.confirm}})},tpdj:function(t){"租完即送"==t.spec_value?this.show1=!0:this.show2=!0},tpdj2:function(){this.show3=!0},close1:function(){this.show1=!1},close2:function(){this.show2=!1},close3:function(){this.show3=!1},initShowSku:function(){this.form.show_sku.sku_image=this.form.detail.image[0].file_path,this.form.show_sku.product_price=this.form.detail.product_price,this.form.show_sku.product_sku_id=0,this.form.show_sku.line_price=this.form.detail.line_price,this.form.show_sku.stock_num=this.form.detail.product_stock,this.form.show_sku.sum=1,this.stock=this.form.detail.product_stock},selectAttr:function(t,o,s){for(var i=this.form.specData.spec_attr[t].spec_items,e=this.form.specData.spec_attr,r=0;r<e.length;r++){var n=e[r];n.spec_items[0].spec_value}var u=i[o];if(this.panduan=s,"租完即送"===s.spec_value&&(this.zuwanjisong=1),"租完买断"===s.spec_value&&(this.zuwanjisong=2),u.checked)u.checked=!1,this.form.productSpecArr[t]=null;else{for(var c=0;c<i.length;c++)i[c].checked=!1;u.checked=!0,this.form.productSpecArr[t]=u.item_id}for(var a=0;a<this.form.specData.spec_attr.length;a++){this.form.specData.spec_attr[a];"保障服务"==this.form.specData.spec_attr[a].group_name&&null==this.form.productSpecArr[a]&&(this.form.productSpecArr[a]=this.form.specData.spec_attr[a].spec_items[0].item_id)}for(var d=0;d<this.form.productSpecArr.length;d++)if(null==this.form.productSpecArr[d])return void this.initShowSku();this.updateSpecProduct()},updateSpecProduct:function(){var t=this,o=t.form.productSpecArr.join("_");t.ContinueClicking=!0;var s=t.form.specData.spec_list,i=s.find((function(s){return t.form.show_sku.product_sku_id=o,s.spec_sku_id==o+"_2"}));"object"===(0,r.default)(i)&&(t.stock=i.spec_form.stock_num,t.form.show_sku.sum>t.stock&&(t.form.show_sku.sum=t.stock>0?t.stock:1),t.form.show_sku.product_price=i.spec_form.product_price,this.buy_out_price=i.spec_form.buy_out_price,"1"==this.panduan.item_id?this.is=!0:this.is=!1,t.form.show_sku.produnt_period=i.spec_form.produnt_period,t.form.show_sku.line_price=i.spec_form.line_price,t.form.show_sku.stock_num=i.spec_form.stock_num,i.spec_form.image_id>0?t.form.show_sku.sku_image=i.spec_form.image_path:t.form.show_sku.sku_image=t.form.detail.image[0].file_path)},closePopup:function(){this.$emit("close",this.form.specData,null)},confirmFunc:function(){var o=this;0!=this.ContinueClicking?my.getLocation({type:1,success:function(s){var i={};i.country=s.country,i.province=s.province,i.city=s.city,i.district=s.district,t.setStorageSync("getLocation",i),o.createdOrder()},fail:function(o){console.log(o),t.showToast({title:"请允许获取位置信息,以便我们分配就近仓库尽快发货",duration:2e3})},complete:function(){}}):t.showToast({title:"请选择完整的规格",duration:2e3})},addCart:function(){var o=this,s=o.form.detail.product_id,i=o.form.show_sku.sum,e=o.form.show_sku.product_sku_id;if(20==o.form.detail.spec_type&&0==e)return t.showToast({title:"请选择属性",icon:"none",duration:2e3}),!1;o._post("order.cart/add",{product_id:s,total_num:i,product_sku_id:e},(function(s){t.showToast({title:s.msg,duration:2e3}),o.$emit("close",null,s.data.cart_total_num)}))},createdOrder:function(){var o=this.form.detail.product_id;""==o&&t.showToast({title:"产品ID不存在",icon:"none",duration:2e3});var s=this.form.show_sku.sum;""==s&&t.showToast({title:"产品数量不存在",icon:"none",duration:2e3});var i=this.form.show_sku.product_sku_id+"_"+this.zuwanjisong;""==i&&t.showToast({title:"规格不存在",icon:"none",duration:2e3});var e="";this.form.room_id&&(e="&room_id="+this.form.room_id),""==this.zmshow&&t.showToast({title:"显示不存在",icon:"none",duration:2e3}),t.navigateTo({url:"/pages/order/confirm-order?product_id="+o+"&product_num="+s+"&product_sku_id="+i+"&order_type=buy"+e+"&zmshow="+this.zmshow})},add:function(){if(!(this.stock<=0))return this.form.show_sku.sum>=this.stock?(t.showToast({title:"数量超过了库存",icon:"none",duration:2e3}),!1):this.form.detail.limit_num>0&&this.form.show_sku.sum>=this.form.detail.limit_num?(t.showToast({title:"数量超过了限购数量",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum++},sub:function(){if(!(this.stock<=0))return this.form.show_sku.sum<2?(t.showToast({title:"商品数量至少为1",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum--}}};o.default=u}).call(this,s("c11b")["default"])},a293:function(t,o,s){"use strict";s.r(o);var i=s("d93a"),e=s("1806");for(var r in e)["default"].indexOf(r)<0&&function(t){s.d(o,t,(function(){return e[t]}))}(r);s("1020");var n=s("f0c5"),u=Object(n["a"])(e["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);o["default"]=u.exports},d93a:function(t,o,s){"use strict";s.d(o,"b",(function(){return e})),s.d(o,"c",(function(){return r})),s.d(o,"a",(function(){return i}));var i={uPopup:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(s.bind(null,"a40d"))}},e=function(){var t=this.$createElement;this._self._c;this._isMounted||(this.e0=!0)},r=[]},fa03:function(t,o,s){}}]);
;(my["webpackJsonp"] = my["webpackJsonp"] || []).push([
    'pages/product/detail/popup/spec-create-component',
    {
        'pages/product/detail/popup/spec-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('c11b')['createComponent'](__webpack_require__("a293"))
        })
    },
    [['pages/product/detail/popup/spec-create-component']]
]);
